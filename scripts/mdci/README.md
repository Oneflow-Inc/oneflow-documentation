# 如何使用 docs.yml 和 mkcodes.py 进行文档的自动检查

## 基本介绍
docs.yml 是一个配置文件，mkcodes.py 将根据其中的内容，查找仓库中指定的文档，并测试指定的代码块和验证输出。比如下面的这个例子，mkcodes.py 会在配置合适的情况下，运行代码块中的代码，并将下方的文本块和程序的输出进行比较验证。如果程序运行错误或者比较结果不一致，则会报错。

```python
print("Hello World!")
```
输出结果：
```text
Hello World!
```
考虑到一些代码无法被运行，一些文本块也包含着随机的输出（例如 `rand()` )，无法被用于验证程序，可以通过 `RUN` 和 `TEST` 两个参数，仅检测部分的代码块和文字块。如果选择了多个代码块，则会将他们作为整段代码执行。

原则上，为了防止新建的文档忘记被收录，docs.yml 记录了本仓库中所有的文档，且会在发现有未被记录的文档时**报错**。因此，即使文档内没有需要被测试的代码，也需要将文档的相对路径和名称在 docs.yml 内进行配置。  
 
每个文档的路径和用于测试的两个可选参数将以以下格式被记录。

```yml 
en/docs/basics/02_tensor.md:
  RUN: all 
  TEST: [0, 2, 3, 4, 5, 6, 7]
```

## 快速上手
假设我们完成了一个相对路径和名称为 `en/docs/basics/02_tensor.md` 的文档。  
1. 首先，前往 scripts 文件夹，打开 docs.yml ，在文档的结尾处新建一行，输入：
```yml
en/docs/basics/02_tensor.md:
```
**如果文档中没有任何需要被运行以测试的代码块，或者代码块的运行涉及到下载数据集等繁琐步骤，那么到这一步便可以结束了。** 如果有，那么请到下一步。  
  
2. 检视文档中所有被 \```python ``` 格式包裹的代码。如果所有的代码都需要被执行，则在第二行**开头空两个空格**，并输入：

```yml
en/docs/basics/02_tensor.md:
  RUN: all 
```
如果只有部分的代码块需要被执行，比如第 1, 2, 3 块代码需要被执行，则输入：
```yml
en/docs/basics/02_tensor.md:
  RUN: [0, 1, 2] 
```
**如果文档中没有任何需要和运行结果进行对比验证的文本块，那么到这一步便可以结束了。** 如果有，那么请到下一步。     
  
3. 检视文档中所有被 \```text ``` 格式包裹的文本。如果所有的文本都需要和程序的输出结果进行验证，则在第三行**开头空两个空格**，并输入：
```yml
en/docs/basics/02_tensor.md:
  RUN: all 
  TEST: all
```
如果只有部分的输出结果需要被验证，比如第 2, 3 块文本块内的输出结果，则输入：
```yml
en/docs/basics/02_tensor.md:
  RUN: all 
  TEST: [1,2]
```
至此，一篇文档的配置工作就结束了。
    
如果需要使用 mkcodes.py 进行测试，可以使用以下命令：
```shell
cd scripts && python mkcodes.py
```